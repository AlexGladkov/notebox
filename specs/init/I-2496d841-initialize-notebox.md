# Спецификация: Initialize NoteBox

## Идентификатор
I-2496d841-initialize-notebox

## Краткое описание
Создание веб-приложения NoteBox — простого Notion-подобного приложения для управления заметками с поддержкой папок и markdown-форматирования.

---

## Собранные требования

### Технологический стек
- **Фреймворк**: Vue 3 + TypeScript
- **Сборщик**: Vite
- **Стилизация**: Tailwind CSS
- **Markdown**: marked.js для рендеринга + textarea для редактирования
- **Хранение данных**: LocalStorage браузера

### Структура данных
- Неограниченная вложенность папок (древовидная структура)
- Заметки могут находиться в любой папке
- Каждая заметка содержит: id, название, содержимое (markdown), дату создания/изменения

### UI/UX требования
- **Layout**: Фиксированный сайдбар слева (250px) + основная область справа
- **Сайдбар**: Дерево папок с возможностью раскрытия/сворачивания
- **Редактор**: Split-view с textarea слева и превью markdown справа
- **Тема**: Только светлая тема (для MVP)

### Функциональные требования
1. **Папки**:
   - Создание папок (в корне и внутри других папок)
   - Переименование папок
   - Удаление папок (с подтверждением, удаляет всё содержимое)
   - Раскрытие/сворачивание в дереве навигации

2. **Заметки**:
   - Создание заметок внутри папок
   - Редактирование заметок (название + содержимое)
   - Удаление заметок (с подтверждением)
   - Автосохранение при изменениях (debounced)
   - Поддержка markdown-форматирования

3. **Поиск**:
   - Поиск только по названиям заметок
   - Глобальный поиск по всем папкам

4. **Навигация**:
   - Клик по папке показывает её содержимое
   - Клик по заметке открывает её для редактирования

### Вне scope (MVP)
- Drag & drop для перемещения папок/заметок
- Тёмная тема
- Поиск по содержимому заметок
- Экспорт/импорт данных
- Синхронизация с сервером
- История изменений / версионирование
- Корзина для удалённых элементов

---

## Структура файлов

```
notebox/
├── index.html
├── package.json
├── tsconfig.json
├── vite.config.ts
├── tailwind.config.js
├── postcss.config.js
├── src/
│   ├── main.ts
│   ├── App.vue
│   ├── style.css
│   ├── types/
│   │   └── index.ts              # Типы: Folder, Note, AppState
│   ├── composables/
│   │   ├── useStorage.ts         # Работа с LocalStorage
│   │   ├── useFolders.ts         # CRUD операции для папок
│   │   ├── useNotes.ts           # CRUD операции для заметок
│   │   └── useSearch.ts          # Поиск по заметкам
│   ├── components/
│   │   ├── Sidebar.vue           # Левая панель с деревом папок
│   │   ├── FolderTree.vue        # Рекурсивный компонент дерева папок
│   │   ├── FolderItem.vue        # Элемент папки в дереве
│   │   ├── NoteList.vue          # Список заметок в выбранной папке
│   │   ├── NoteEditor.vue        # Редактор заметки (split-view)
│   │   ├── SearchBar.vue         # Поле поиска
│   │   ├── ConfirmDialog.vue     # Диалог подтверждения удаления
│   │   └── EmptyState.vue        # Состояние "нет заметок"
│   └── utils/
│       └── markdown.ts           # Утилиты для marked.js
└── public/
    └── favicon.ico
```

---

## Детали реализации

### Типы данных (types/index.ts)

```typescript
interface Folder {
  id: string;
  name: string;
  parentId: string | null;  // null для корневых папок
  createdAt: number;
  updatedAt: number;
}

interface Note {
  id: string;
  title: string;
  content: string;  // markdown
  folderId: string;
  createdAt: number;
  updatedAt: number;
}

interface AppState {
  folders: Folder[];
  notes: Note[];
  selectedFolderId: string | null;
  selectedNoteId: string | null;
  searchQuery: string;
}
```

### Хранение в LocalStorage

Ключи:
- `notebox_folders` — JSON массив папок
- `notebox_notes` — JSON массив заметок

### Автосохранение

- Debounce: 500ms после последнего изменения
- Сохранение в LocalStorage при каждом изменении заметки

### Markdown рендеринг

- Использовать marked.js для преобразования markdown в HTML
- Sanitize HTML для безопасности (DOMPurify или встроенная санитизация marked)

### Компонент FolderTree

- Рекурсивный компонент для отображения вложенных папок
- Иконки для папок (открыта/закрыта)
- Кнопки действий при hover (создать подпапку, удалить)

### Диалог подтверждения

- Модальное окно с кнопками "Отмена" и "Удалить"
- Для папок показывать количество вложенных элементов

---

## Критерии приёмки

1. [ ] Приложение запускается через `npm run dev`
2. [ ] Можно создавать папки в корне и внутри других папок
3. [ ] Можно создавать заметки внутри папок
4. [ ] Можно редактировать заметки с автосохранением
5. [ ] Markdown отображается корректно в превью
6. [ ] Поиск находит заметки по названию
7. [ ] Удаление папки удаляет всё содержимое (с подтверждением)
8. [ ] Удаление заметки требует подтверждения
9. [ ] Данные сохраняются в LocalStorage и восстанавливаются при перезагрузке
10. [ ] Сайдбар корректно отображает дерево папок с вложенностью
11. [ ] Split-view редактор работает корректно

---

## Риски и edge cases

1. **Размер LocalStorage**: Ограничен ~5-10MB. Для MVP достаточно, но при большом количестве заметок может быть проблема.

2. **Производительность дерева папок**: При большой глубине вложенности может быть проблема с рендерингом. Решение: виртуализация (вне scope MVP).

3. **Конфликты при множественных вкладках**: LocalStorage не синхронизируется между вкладками автоматически. Решение: слушать событие `storage` (можно добавить позже).

4. **Потеря данных**: При очистке браузера данные теряются. Решение: экспорт/импорт (вне scope MVP).

5. **XSS через markdown**: Необходимо санитизировать HTML после рендеринга markdown.

---

## Зависимости (package.json)

```json
{
  "dependencies": {
    "vue": "^3.4",
    "marked": "^12.0",
    "uuid": "^9.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.0",
    "typescript": "^5.3",
    "vite": "^5.0",
    "tailwindcss": "^3.4",
    "postcss": "^8.4",
    "autoprefixer": "^10.4",
    "@types/uuid": "^9.0"
  }
}
```

---

## Порядок реализации

1. Инициализация проекта (Vite + Vue + TypeScript + Tailwind)
2. Создание типов данных
3. Реализация composables для работы с данными
4. Создание базовых компонентов (Sidebar, FolderTree)
5. Реализация редактора заметок
6. Добавление поиска
7. Диалоги подтверждения
8. Тестирование и отладка
