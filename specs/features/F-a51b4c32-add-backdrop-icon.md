# Спецификация: Улучшение UI иконки и обложки заметки

**ID:** F-a51b4c32
**Дата:** 2026-02-16
**Статус:** Готово к реализации

## Краткое описание

Изменение позиционирования иконки (эмодзи) в стиле Notion: иконка должна располагаться поверх обложки в нижнем левом углу, частично перекрывая её. Также упрощение UI взаимодействия с иконкой.

## Требования, собранные на интервью

### Основные решения

1. **Позиционирование иконки:**
   - Иконка располагается поверх обложки, частично выходя за её нижнюю границу (Notion-style)
   - Позиция: нижний левый угол обложки
   - Если обложки нет, иконка остаётся над заголовком (текущее поведение)

2. **Взаимодействие с иконкой:**
   - При наведении показывается только крестик удаления (справа сверху от иконки)
   - Клик по иконке открывает EmojiPicker для изменения
   - Кнопки "Изменить" и "Удалить" удаляются

3. **Визуальный стиль иконки:**
   - Без дополнительного оформления (без теней, фонов, обводок)
   - Чистый эмодзи

4. **Размеры:**
   - Сохраняются текущие размеры: 78px в редакторе
   - Обложка: 200px высота

5. **Отображение в списке заметок (NoteList):**
   - Иконка отображается поверх превью обложки (уменьшенный вариант)
   - Если обложки нет, иконка не отображается в списке

## Файлы для изменения

### Компоненты Vue

1. **`src/components/NoteIcon.vue`**
   - Удалить кнопки "Изменить" и "Удалить"
   - Добавить крестик удаления в правом верхнем углу (появляется при наведении)
   - Клик по иконке открывает picker напрямую

2. **`src/components/NoteCover.vue`**
   - Добавить слот или пропс для размещения иконки поверх обложки
   - Позиционирование: `position: absolute; bottom: -39px; left: 24px;` (половина иконки выступает)

3. **`src/components/NoteEditor.vue`**
   - Изменить расположение NoteIcon — вынести его внутрь NoteCover или создать wrapper
   - При наличии обложки — иконка внутри NoteCover
   - При отсутствии обложки — иконка над заголовком (текущее поведение)

4. **`src/components/NoteList.vue`**
   - Изменить отображение иконки: вместо рядом с заголовком — поверх превью обложки
   - Уменьшенный размер иконки для списка (например, 32px)
   - Позиция: нижний левый угол превью обложки

### CSS изменения

- `.note-icon-wrapper` — новый стиль для абсолютного позиционирования поверх обложки
- `.delete-btn` — крестик удаления с абсолютным позиционированием
- Анимация появления крестика при наведении

## Детали реализации

### NoteIcon.vue — новая структура

```vue
<template>
  <div
    v-if="icon || showAddButton"
    class="note-icon-wrapper"
    :class="{ 'has-icon': icon }"
    @mouseenter="showDeleteBtn = true"
    @mouseleave="showDeleteBtn = false"
  >
    <div v-if="icon" class="note-icon" @click="togglePicker">
      <span class="icon-emoji">{{ icon }}</span>
      <button
        v-if="showDeleteBtn"
        class="delete-btn"
        @click.stop="removeIcon"
        title="Удалить иконку"
      >
        ×
      </button>
    </div>

    <button v-else class="add-icon-btn" @click="togglePicker">
      <span>Добавить иконку</span>
    </button>

    <EmojiPicker
      :is-open="pickerOpen"
      @select="selectEmoji"
      @close="pickerOpen = false"
    />
  </div>
</template>
```

### NoteCover.vue — добавление слота для иконки

Иконка передаётся как слот или рендерится внутри компонента:

```vue
<div class="cover-image" ...>
  <!-- существующий контент -->
  <slot name="icon"></slot>  <!-- для иконки -->
</div>
```

### NoteEditor.vue — новая структура

```vue
<template>
  <div v-if="note" class="h-full flex flex-col">
    <div class="note-header">
      <NoteCover v-if="note.backdropType" ...>
        <template #icon>
          <NoteIcon :icon="note.icon" @update="handleIconUpdate" />
        </template>
      </NoteCover>

      <!-- Если нет обложки, иконка отдельно над заголовком -->
      <NoteIcon v-else :icon="note.icon" @update="handleIconUpdate" />

      <input v-model="localTitle" ... />
    </div>
  </div>
</template>
```

### NoteList.vue — иконка поверх превью

```vue
<div class="note-card">
  <div v-if="note.backdropType" class="note-cover-preview" :style="getCoverStyle(note)">
    <span v-if="note.icon" class="note-list-icon">{{ note.icon }}</span>
  </div>
  <div class="note-content">
    <h3>{{ note.title }}</h3>
    ...
  </div>
</div>
```

## Критерии приёмки

1. [ ] Иконка располагается поверх обложки в нижнем левом углу, частично выступая за границу
2. [ ] При наведении на иконку появляется крестик удаления (справа сверху)
3. [ ] Клик по иконке открывает EmojiPicker
4. [ ] Клик по крестику удаляет иконку
5. [ ] Без обложки иконка отображается над заголовком
6. [ ] В списке заметок иконка показывается поверх превью обложки (уменьшенная)
7. [ ] Размеры элементов не изменены (иконка 78px, обложка 200px)
8. [ ] Корректная работа в тёмной теме

## Edge Cases

1. **Нет обложки, но есть иконка** — иконка над заголовком, кнопка "Добавить обложку" независима
2. **Есть обложка, нет иконки** — при наведении на область иконки появляется "Добавить иконку"
3. **Очень длинный эмодзи (составные)** — ограничить ширину, overflow hidden
4. **Мобильные устройства** — touch взаимодействие: долгий тап для удаления

## Риски и ограничения

1. **Z-index конфликты** — иконка поверх обложки требует правильного z-index
2. **Transition при добавлении/удалении обложки** — иконка должна плавно перемещаться
3. **Позиция пикера эмодзи** — может выходить за границы экрана, нужна проверка

## Вне scope

- Добавление новых типов обложек (градиенты, паттерны)
- Добавление кастомных изображений вместо эмодзи
- Изменение размеров элементов
- Drag-and-drop для иконки
