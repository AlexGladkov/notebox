# Спецификация: Превью обложки (backdrop) в списке заметок

## ID: F-00ee2fe7

## Резюме

Добавить отображение миниатюры обложки (backdrop) в списке заметок для визуального превью. Иконка (emoji) уже отображается в списке — требуется добавить только превью обложки.

## Контекст

В проекте уже реализована функциональность добавления обложки (backdrop) и иконки (emoji) к заметкам:
- Компоненты `NoteCover.vue` и `NoteIcon.vue` работают в редакторе заметок (`NoteEditor.vue`)
- Модель данных `Note` содержит поля: `icon`, `backdropType`, `backdropValue`, `backdropPositionY`
- Типы обложек: `gradient` (CSS-градиент) и `image` (URL изображения)
- Иконка уже отображается в списке заметок (`NoteList.vue`, строка 35)

**Что нужно:** Добавить миниатюру обложки в списке заметок над содержимым карточки.

## Требования (собраны в ходе интервью)

### Визуальные требования

| Параметр | Значение |
|----------|----------|
| Высота миниатюры | 40-60px (маленькая, компактный вид) |
| Режим отображения изображения | `cover` (заполнение с обрезкой) |
| Плейсхолдер для заметок без обложки | Не нужен — заметки без обложки отображаются компактнее |
| Скруглённые углы | Да, `border-radius: 8px` |
| Анимация при наведении | Нет (статичное отображение) |

### Расположение

- Миниатюра обложки отображается **сверху** карточки заметки в списке (как в Notion)
- Только в компоненте `NoteList.vue`
- Не нужно отображать в боковой панели (sidebar) или в табах

### Поведение

- Если у заметки нет обложки (`backdropType` = `null`), миниатюра не отображается
- Если `backdropType = 'gradient'`, отображается градиент как фон миниатюры
- Если `backdropType = 'image'`, отображается изображение с `background-size: cover`
- Позиция изображения (`backdropPositionY`) должна учитываться при отображении

## Файлы для изменения

### Модификация существующих файлов

1. **`src/components/NoteList.vue`**
   - Добавить блок миниатюры обложки над содержимым каждой карточки заметки
   - Условный рендеринг: показывать только если `note.backdropType` не null
   - Стили для миниатюры с учётом требований

## Детальный план реализации

### Шаг 1: Модификация NoteList.vue

Добавить в шаблон перед блоком с контентом заметки:

```vue
<div
  v-if="note.backdropType"
  class="note-cover-preview"
  :style="getCoverStyle(note)"
/>
```

Добавить вспомогательную функцию `getCoverStyle`:

```typescript
const getCoverStyle = (note: Note): Record<string, string> => {
  const style: Record<string, string> = {
    height: '48px',
    borderRadius: '8px 8px 0 0',
    marginBottom: '8px',
  };

  if (note.backdropType === 'gradient' && note.backdropValue) {
    style.background = note.backdropValue;
  } else if (note.backdropType === 'image' && note.backdropValue) {
    style.backgroundImage = `url("${note.backdropValue}")`;
    style.backgroundSize = 'cover';
    style.backgroundPosition = `center ${note.backdropPositionY || 50}%`;
  }

  return style;
};
```

### Шаг 2: Стили

Добавить CSS для класса `.note-cover-preview`:

```css
.note-cover-preview {
  width: 100%;
  height: 48px;
  border-radius: 8px 8px 0 0;
  overflow: hidden;
  background-position: center;
  background-size: cover;
}
```

## Критерии приёмки

1. [ ] При наличии обложки (`backdropType` не null) в карточке заметки отображается миниатюра обложки высотой 48px
2. [ ] Миниатюра корректно отображает градиенты (`backdropType = 'gradient'`)
3. [ ] Миниатюра корректно отображает изображения (`backdropType = 'image'`) с режимом cover
4. [ ] Учитывается позиция изображения (`backdropPositionY`)
5. [ ] Миниатюра имеет скруглённые углы сверху (8px)
6. [ ] Заметки без обложки отображаются без миниатюры (компактный вид)
7. [ ] Отсутствуют анимации при наведении на миниатюру
8. [ ] Корректная работа в тёмной теме
9. [ ] Сохраняется совместимость с существующим функционалом (иконка, выделение активной заметки)

## Граничные случаи и риски

### Граничные случаи

1. **Невалидный URL изображения** — браузер отобразит пустую область или битое изображение. Рекомендуется добавить fallback или скрывать миниатюру при ошибке загрузки.
2. **Длинный список заметок** — много изображений могут влиять на производительность. Рекомендуется использовать `loading="lazy"` для изображений или виртуализацию списка.
3. **Отсутствие backdropValue при наличии backdropType** — проверять оба поля перед рендерингом.

### Риски

- **Производительность**: при большом количестве заметок с изображениями может увеличиться потребление памяти
- **Консистентность**: убедиться, что стили миниатюры соответствуют общему дизайну приложения

## Вне области задачи (Out of Scope)

- Отображение обложки в боковой панели (sidebar)
- Отображение иконки/обложки в табах
- Изменение функциональности выбора обложки в редакторе
- Добавление новых типов обложек
- Lazy loading изображений (может быть добавлено в отдельной задаче)

## Связанные файлы

- `src/components/NoteList.vue` — основной файл для модификации
- `src/components/NoteCover.vue` — референс для стилей обложки
- `src/types/index.ts` — типы данных Note

## Оценка сложности

**Низкая** — изменения затрагивают только один файл, логика простая.
