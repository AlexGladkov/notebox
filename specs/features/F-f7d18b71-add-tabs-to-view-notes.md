# Спецификация: Добавление вкладок для просмотра заметок

## Идентификатор
F-f7d18b71-add-tabs-to-view-notes

## Краткое описание
Реализация системы вкладок для одновременной работы с несколькими заметками, аналогично вкладкам в браузере или Notion.

## Требования (по результатам интервью)

### Расположение и структура
- **Удалить компонент Header** полностью
- **Панель вкладок** располагается над редактором заметки (горизонтально)
- **Переключатель темы** переносится в нижнюю часть сайдбара

### Открытие заметок во вкладках
- **Обычный клик** по заметке в списке — заменяет активную вкладку
- **Ctrl+клик (Cmd+клик на Mac)** — открывает заметку в новой вкладке
- Максимальное количество вкладок: **50**

### Закрытие вкладок
- Кнопка "×" **появляется при наведении** на вкладку
- При закрытии активной вкладки активируется **следующая вкладка справа** (или последняя, если закрыли последнюю в ряду)
- Если закрыты все вкладки — показывается EmptyState

### Перетаскивание вкладок
- Вкладки можно **перетаскивать** для изменения порядка (drag & drop)

### Содержимое вкладки
- Показывается **только название заметки**

### Переполнение вкладок
- При большом количестве вкладок они **сжимаются до минимальной ширины**
- Появляется кнопка **"..."** с выпадающим списком всех открытых вкладок

### Контекстное меню
- При правом клике на вкладку показывается меню:
  - "Закрыть"
  - "Закрыть другие"
  - "Закрыть все"

### Удаление заметки
- Если заметка удалена через список заметок, её вкладка **автоматически закрывается**

### Визуальный стиль
- **Минималистичный стиль как в Notion**
- Лёгкое выделение активной вкладки (без агрессивных эффектов)
- Поддержка светлой и тёмной темы

### Сохранение состояния
- Вкладки **НЕ сохраняются** между сессиями (отложено на будущее)

## Файлы для создания

### Новые файлы
1. `src/components/TabBar.vue` — компонент панели вкладок
2. `src/components/TabItem.vue` — компонент отдельной вкладки
3. `src/components/TabContextMenu.vue` — контекстное меню вкладки
4. `src/components/TabOverflowMenu.vue` — выпадающий список "..." для переполнения
5. `src/composables/useTabs.ts` — composable для управления состоянием вкладок

## Файлы для модификации

1. `src/App.vue`
   - Удалить импорт и использование `Header`
   - Добавить импорт `TabBar`
   - Интегрировать систему вкладок вместо единственной активной заметки
   - Обновить логику `handleSelectNote` для работы с вкладками
   - Обновить логику `handleDeleteNote` для автоматического закрытия вкладки

2. `src/components/Sidebar.vue`
   - Добавить переключатель темы в нижнюю часть
   - Импортировать логику темы из `useTheme`

3. `src/components/NoteList.vue`
   - Добавить обработку Ctrl+клик для открытия в новой вкладке
   - Передавать информацию о модификаторе клавиши

4. `src/components/NoteEditor.vue`
   - Возможно потребуется адаптация под работу с несколькими экземплярами (если используется один компонент на все вкладки)

## Детальный план реализации

### Этап 1: Создание composable useTabs
```typescript
// src/composables/useTabs.ts
interface Tab {
  id: string;      // уникальный ID вкладки
  noteId: string;  // ID заметки
  title: string;   // название (для отображения)
}

// Экспортируемые функции:
- tabs: Ref<Tab[]>
- activeTabId: Ref<string | null>
- openTab(noteId: string, forceNew: boolean): void
- closeTab(tabId: string): void
- closeOtherTabs(tabId: string): void
- closeAllTabs(): void
- setActiveTab(tabId: string): void
- moveTab(fromIndex: number, toIndex: number): void
- getActiveNote(): Note | undefined
- updateTabTitle(noteId: string, title: string): void
- removeTabsByNoteId(noteId: string): void
```

### Этап 2: Создание компонента TabItem
- Отображение названия заметки
- Кнопка закрытия (видна при hover)
- Обработка клика (активация вкладки)
- Обработка правого клика (контекстное меню)
- Поддержка drag & drop
- Визуальное выделение активной вкладки

### Этап 3: Создание компонента TabContextMenu
- Позиционирование относительно клика
- Три пункта меню
- Закрытие при клике вне меню

### Этап 4: Создание компонента TabOverflowMenu
- Кнопка "..." при переполнении
- Выпадающий список всех вкладок
- Возможность выбора вкладки из списка

### Этап 5: Создание компонента TabBar
- Контейнер для вкладок
- Логика определения переполнения
- Интеграция TabOverflowMenu
- Drag & drop reordering

### Этап 6: Модификация Sidebar
- Добавить секцию внизу с переключателем темы
- Стилизация под общий дизайн

### Этап 7: Интеграция в App.vue
- Удаление Header
- Подключение TabBar
- Обновление логики выбора и удаления заметок
- Обработка Ctrl+клик

### Этап 8: Удаление Header.vue
- Удалить файл `src/components/Header.vue`

## Критерии приёмки

1. [ ] Header удалён, переключатель темы в сайдбаре
2. [ ] Вкладки отображаются над редактором
3. [ ] Клик по заметке заменяет активную вкладку
4. [ ] Ctrl/Cmd+клик открывает заметку в новой вкладке
5. [ ] Кнопка закрытия появляется при наведении
6. [ ] При закрытии активной вкладки активируется соседняя
7. [ ] Вкладки можно перетаскивать
8. [ ] При 50+ вкладках новые не создаются (или показывается предупреждение)
9. [ ] При переполнении вкладки сжимаются, появляется кнопка "..."
10. [ ] Контекстное меню работает корректно
11. [ ] Удаление заметки закрывает её вкладку
12. [ ] Поддержка светлой и тёмной темы
13. [ ] Минималистичный визуальный стиль (как в Notion)

## Граничные случаи и риски

### Граничные случаи
- Открытие одной и той же заметки повторно — должна активироваться существующая вкладка
- Закрытие последней вкладки — показать EmptyState
- Удаление папки с заметками — закрыть все вкладки удалённых заметок
- Переименование заметки — обновить название во вкладке
- Достижение лимита в 50 вкладок — показать уведомление или заменить самую старую

### Риски
- **Производительность**: Много открытых вкладок с редакторами может влиять на производительность. Решение: ленивая загрузка контента вкладок (загружать только активную).
- **Drag & drop**: Может быть сложно реализовать без сторонней библиотеки. Рекомендация: использовать нативный HTML5 drag & drop или библиотеку типа vue-draggable.

## Вне скоупа

- Сохранение вкладок между сессиями (планируется в будущем с системой пользователей)
- Индикатор несохранённых изменений
- Отображение папки в названии вкладки
- Закрытие вкладок "справа" и "слева" в контекстном меню
- Средняя кнопка мыши для закрытия
- Keyboard shortcuts для переключения между вкладками

## Технические заметки

- Проект использует Vue 3 с Composition API
- Стилизация через Tailwind CSS
- Состояние управляется через composables (не Vuex/Pinia)
- Для drag & drop рекомендуется использовать `@vueuse/core` или нативный API
